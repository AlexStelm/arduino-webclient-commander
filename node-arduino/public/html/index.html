<!DOCTYPE html> 
<html> 
	<head> 
	<title>My Page</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="../javascripts/jquery.mobile-1.1.0.min.css" />
	<script src="../javascripts/jquery-1.6.4.min.js"></script>

  <script>
  $(document).bind("mobileinit", function(){
    $.mobile.ajaxEnabled = false;
  });

  </script>
	<script src="../javascripts/jquery.mobile-1.1.0.min.js"></script>
  <script src="../javascripts/faye-browser.js"></script>
  <script src="../javascripts/jquery.form.js"></script>

  <script>

	//var client = new Faye.Client('http://192.168.1.102:8080/faye');
  var client = new Faye.Client('http://10.42.43.1:8080/faye');
	  client.subscribe('/data', function(message) {
   // console.log(message.query);
		$('#data').html(message.query);
	  });

  $(document).ready(function(){
	  $('#publish').click(function(){
	  	if($('#text').val()){
			client.publish('/messages', {
			  text: $('#text').val()
			});
			$('#text').val('')
		}
	});
  
  var options = { 
        success: showResponse  // post-submit callback   
    }; 
  
  
    
    $('#txt_red').change(function() {
    
      post();
    });
    
     $('#txt_green').change(function() {
     post();
    });
    
     $('#txt_blue').change(function() {
    post();
    });
    
    
    function post(){
    
      var pixel = 10;
      var red = $("#txt_red").val();
      red = cleanValue(red);
      var green = $("#txt_green").val();
      green = cleanValue(green);
      var blue = $("#txt_blue").val();
      blue = cleanValue(blue)

      var data = pixel + red + green + blue;
      console.log(data);

       $.post("../postData", { cmd: data} );
    }

    function cleanValue(data){
      
      switch(data.length)
      {
          case 1:
            data = "00" + data
            break;
          case 2:
            data = "0" + data
            break;
          case 3:
            break  
          default:
            data = "000"
      }
      return data;
    }
    

    function showResponse(responseText, statusText, xhr, $form)  { 
   
      console.log('status: ' + statusText + '\n\nresponseText: \n' + responseText + 
        '\n\nThe output div should have already been updated with the responseText.'); 
    } 

  
});
</script>
</head> 
<body> 

<div data-role="page">

	<div data-role="header">
		<h1>My Title</h1>
	</div><!-- /header -->

	<div data-role="content">	
    <div id="data"">
      &nbsp
    </div>
    
      <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <label for="slider1">
                            Red:
                        </label>
                        <input type="range" id="txt_red" name="red" id="slider1" value="0" min="0" max="31" data-highlight="false" />
                    </fieldset>
                </div>
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <label for="slider2">
                            Green:
                        </label>
                        <input type="range" id="txt_green"name="green" id="slider2" value="0" min="0" max="31" data-highlight="false" />
                    </fieldset>
                </div>
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup">
                        <label for="slider3">
                            blue:
                        </label>
                        <input type="range" id="txt_blue"name="blue" id="slider3" value="0" min="0" max="31" data-highlight="false" />
                    </fieldset>
    
	
  
	</div><!-- /content -->

</div><!-- /page -->

</body>
</html>
